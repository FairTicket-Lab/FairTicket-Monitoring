suhyen@mac-m2 load-test % ./scripts/04-run-queue-500.sh
=== 스케줄 오픈 상태 확인 (scheduleId=1) ===
스케줄이 아직 오픈되지 않았습니다. seed-db.sh 실행 후 재확인합니다.
Applying seed via Docker (fairticket-postgres)...
UPDATE 1
UPDATE 2
INSERT 0 0
INSERT 0 0
INSERT 0 0
Done. Schedules 1,2,3 are now OPEN with ticket_open_at in the past.
스케줄이 오픈된 상태로 설정되었습니다.

=== 토큰 재발급 (실행 시마다 새로 발급) ===
=== 기존 토큰 유효성 검증 ===
유효한 토큰: 1374개
=== 추가 토큰 불필요 (유효한 토큰이 충분함: 1374/500) ===
Total tokens: 1374 (유효한 기존 토큰: 1374, 새로 발급: 0)
=== JSON 형식 변환 ===
Generated /Users/suhyen/Documents/GitHub/fairticket-lab/FairTicket-BE/load-test/data/queue/tokens.json (    1374 users)
Done.

=== 환경 검증 (서버 연결, 스케줄 오픈, 토큰 유효성) ===
=== 1) 서버 연결 확인 (http://localhost:8080) ===
  OK

=== 2) 스케줄 오픈 여부 (CONCERT_ID=1, SCHEDULE_ID=1) ===
  OK (해당 회차 오픈)

=== 3) 토큰 1건으로 Queue Enter 실제 호출 (HTTP 코드 확인) ===
  HTTP 상태: 200
  응답 본문: {"scheduleId":1,"userId":5,"position":0,"estimatedWaitMinutes":0,"message":"이미 입장 토큰이 발급되었습니다"}
  OK — 토큰 유효, 2xx 기대 가능.

=== 검증 완료: 시나리오 실행 가능 상태입니다. ===

=== 대기열 시나리오: enter → status (WAITING 대기) → READY 흐름 ===
k6 실행: VUs=500, Duration=60s, TPS=500


         /\      Grafana   /‾‾/  
    /\  /  \     |\  __   /  /   
   /  \/    \    | |/ /  /   ‾‾\ 
  /          \   |   (  |  (‾)  |
 / __________ \  |_|\_\  \_____/ 


     execution: local
        script: scripts/queue-flow.js
        output: -

     scenarios: (100.00%) 1 scenario, 1000 max VUs, 1m30s max duration (incl. graceful stop):
              * constant_arrival_rate: 500.00 iterations/s for 1m0s (maxVUs: 500-1000, gracefulStop: 30s)


  === Load Test Summary ===

  === 요청 통계 ===
    Enter requests: 30001
    Status requests: 30089
    Heartbeat requests: 4
    READY received: 30000
    Total requests: 60094
    Failed requests rate: 0.12%

  === 전체 HTTP 요청 지연시간 (ms) ===
    min: 0.50
    avg: 1.44
    max: 122.37
    p50: 0.74
    p90: 1.22
    p95: 2.81
    p99: 0.00

  === Enter API 지연시간 (ms) ===
    count: 30001
    min: 0.55
    avg: 1.62
    max: 122.37
    p50: 0.76
    p90: 1.26
    p95: 3.04
    p99: 0.00

  === Status API 지연시간 (ms) ===
    count: 30089
    min: 0.50
    avg: 1.26
    max: 93.68
    p50: 0.72
    p90: 1.18
    p95: 2.60
    p99: 0.00

  === Heartbeat API 지연시간 (ms) ===
    count: 4
    min: 1.47
    avg: 5.74
    max: 9.15
    p50: 6.18
    p90: 8.35
    p95: 8.75
    p99: 0.00

  === Enter → READY 소요 시간 (ms) ===
    count: 30000
    min: 1.00
    avg: 2.68
    max: 144.00
    p50: 1.00
    p90: 3.00
    p95: 6.00
    p99: 0.00

  === 처리량 ===
    설정된 테스트 시간: 60.00초
    실제 실행 시간: 90.00초 (graceful stop 포함)
    RPS 계산 기준 시간: 60.00초
    전체 평균 RPS: 1001.57 (Enter + Status + Heartbeat 합계)
    Enter RPS: 500.02
    Status RPS: 501.48
    Heartbeat RPS: 0.07
    실제 TPS (Enter/초): 500.02
    목표 TPS: 500
    TPS 달성률: 100.00%

running (1m30.0s), 0000/0500 VUs, 30000 complete and 1 interrupted iterations
constant_arrival_rate ✓ [==============] 0001/0500 VUs  1m0s  500.00 iters/s